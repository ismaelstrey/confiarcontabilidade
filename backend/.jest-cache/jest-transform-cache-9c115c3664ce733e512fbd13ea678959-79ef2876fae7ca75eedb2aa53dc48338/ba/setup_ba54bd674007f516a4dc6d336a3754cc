4f8014d3a656d23fd1375e4888b525d4
"use strict";
/**
 * Configura칞칚o global para testes unit치rios
 * Contabilidade Igrejinha Backend
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.testUtils = void 0;
const globals_1 = require("@jest/globals");
// Configurar mocks globais para m칩dulos externos
// jest.mock('nodemailer', () => ({
//   createTransport: jest.fn(() => ({
//     sendMail: jest.fn().mockResolvedValue("Teste" ),
//     verify: jest.fn().mockResolvedValue(true),
//   })),
// }));
globals_1.jest.mock('ioredis', () => {
    const mockRedis = {
        get: globals_1.jest.fn(),
        set: globals_1.jest.fn(),
        del: globals_1.jest.fn(),
        exists: globals_1.jest.fn(),
        expire: globals_1.jest.fn(),
        flushall: globals_1.jest.fn(),
        quit: globals_1.jest.fn(),
        // ping: jest.fn().mockResolvedValue('PONG'),
        on: globals_1.jest.fn(),
        connect: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    };
    return globals_1.jest.fn(() => mockRedis);
});
// Mock do winston para evitar problemas de logging em testes
globals_1.jest.mock('winston', () => ({
    createLogger: globals_1.jest.fn(() => ({
        info: globals_1.jest.fn(),
        error: globals_1.jest.fn(),
        warn: globals_1.jest.fn(),
        debug: globals_1.jest.fn(),
    })),
    format: {
        combine: globals_1.jest.fn(() => globals_1.jest.fn()),
        timestamp: globals_1.jest.fn(() => globals_1.jest.fn()),
        errors: globals_1.jest.fn(() => globals_1.jest.fn()),
        json: globals_1.jest.fn(() => globals_1.jest.fn()),
        colorize: globals_1.jest.fn(() => globals_1.jest.fn()),
        simple: globals_1.jest.fn(() => globals_1.jest.fn()),
        printf: globals_1.jest.fn(() => globals_1.jest.fn()),
    },
    transports: {
        Console: globals_1.jest.fn(),
        File: globals_1.jest.fn(),
    },
}));
// Mock do logger middleware
globals_1.jest.mock('../src/middlewares/logger', () => ({
    logger: {
        info: globals_1.jest.fn(),
        error: globals_1.jest.fn(),
        warn: globals_1.jest.fn(),
        debug: globals_1.jest.fn(),
    },
    logStream: {
        write: globals_1.jest.fn(),
    },
    logPerformance: globals_1.jest.fn(),
    logDatabaseQuery: globals_1.jest.fn(),
    logAuth: globals_1.jest.fn(),
    logFileUpload: globals_1.jest.fn(),
    logEmail: globals_1.jest.fn(),
    logCache: globals_1.jest.fn(),
}));
// Mock dos middlewares de seguran칞a
globals_1.jest.mock('../src/middlewares/security', () => ({
    corsMiddleware: globals_1.jest.fn((req, res, next) => next()),
    helmetMiddleware: globals_1.jest.fn((req, res, next) => next()),
    generalRateLimit: globals_1.jest.fn((req, res, next) => next()),
    authRateLimit: globals_1.jest.fn((req, res, next) => next()),
    apiRateLimit: globals_1.jest.fn((req, res, next) => next()),
    uploadRateLimit: globals_1.jest.fn((req, res, next) => next()),
    compressionMiddleware: globals_1.jest.fn((req, res, next) => next()),
    customSecurityHeaders: globals_1.jest.fn((req, res, next) => next()),
    securityLogger: globals_1.jest.fn((req, res, next) => next()),
}));
// Mock do express-rate-limit
globals_1.jest.mock('express-rate-limit', () => {
    return globals_1.jest.fn(() => (req, res, next) => next());
});
// Mock do multer para upload de arquivos
globals_1.jest.mock('multer', () => {
    const multer = () => ({
        single: () => (req, res, next) => {
            req.file = {
                fieldname: 'file',
                originalname: 'test.jpg',
                encoding: '7bit',
                mimetype: 'image/jpeg',
                size: 1024,
                filename: 'test-123.jpg',
                path: '/tmp/test-123.jpg',
            };
            next();
        },
        array: () => (req, res, next) => {
            req.files = [
                {
                    fieldname: 'files',
                    originalname: 'test1.jpg',
                    encoding: '7bit',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    filename: 'test1-123.jpg',
                    path: '/tmp/test1-123.jpg',
                },
            ];
            next();
        },
    });
    multer.memoryStorage = globals_1.jest.fn();
    multer.diskStorage = globals_1.jest.fn();
    return multer;
});
// Configurar timezone para testes consistentes
process.env.TZ = 'UTC';
// Configurar vari치veis de ambiente para testes
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret';
process.env.JWT_EXPIRES_IN = '1h';
process.env.JWT_REFRESH_SECRET = 'test-refresh-secret';
process.env.JWT_REFRESH_EXPIRES_IN = '7d';
process.env.DATABASE_URL = 'file:./test.db';
process.env.REDIS_URL = 'redis://localhost:6379/1';
process.env.LOG_LEVEL = 'error';
process.env.UPLOAD_PATH = './test-uploads';
// Mock de console para testes mais limpos
global.console = {
    ...console,
    // Manter apenas erros importantes
    log: globals_1.jest.fn(),
    debug: globals_1.jest.fn(),
    info: globals_1.jest.fn(),
    warn: globals_1.jest.fn(),
    error: console.error, // Manter erros vis칤veis
};
// Configura칞칫es globais de timeout
globals_1.jest.setTimeout(30000);
// Limpar todos os mocks ap칩s cada teste
afterEach(() => {
    globals_1.jest.clearAllMocks();
});
// Configurar matchers customizados (se necess치rio)
expect.extend({
    toBeValidDate(received) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid date`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid date`,
                pass: false,
            };
        }
    },
    toBeValidUUID(received) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const pass = typeof received === 'string' && uuidRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid UUID`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid UUID`,
                pass: false,
            };
        }
    },
});
// Utilit치rios para testes
exports.testUtils = {
    // Criar um usu치rio de teste
    createTestUser: () => ({
        id: '123e4567-e89b-12d3-a456-426614174000',
        email: 'test@example.com',
        name: 'Test User',
        role: 'USER',
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
    }),
    // Criar um token JWT de teste
    createTestToken: () => 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.token',
    // Criar dados de requisi칞칚o de teste
    createTestRequest: (overrides = {}) => ({
        body: {},
        params: {},
        query: {},
        headers: {},
        user: exports.testUtils.createTestUser(),
        ...overrides,
    }),
    // Criar dados de resposta de teste
    createTestResponse: () => {
        const res = {};
        res.status = globals_1.jest.fn().mockReturnValue(res);
        res.json = globals_1.jest.fn().mockReturnValue(res);
        res.send = globals_1.jest.fn().mockReturnValue(res);
        res.cookie = globals_1.jest.fn().mockReturnValue(res);
        res.clearCookie = globals_1.jest.fn().mockReturnValue(res);
        return res;
    },
    // Aguardar um tempo espec칤fico (para testes com timers)
    waitFor: (ms) => new Promise(resolve => setTimeout(resolve, ms)),
};
console.log('游빍 Configura칞칚o de testes carregada');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXGRldlxcY29udGFiaWxcXGNvbnRhYmlsLXNpdGVcXGJhY2tlbmRcXHRlc3RzXFxzZXR1cC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFFSCwyQ0FBcUM7QUFnRnJDLGlEQUFpRDtBQUNqRCxtQ0FBbUM7QUFDbkMsc0NBQXNDO0FBQ3RDLHVEQUF1RDtBQUN2RCxpREFBaUQ7QUFDakQsU0FBUztBQUNULE9BQU87QUFFUCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDeEIsTUFBTSxTQUFTLEdBQUc7UUFDaEIsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsUUFBUSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbkIsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZiw2Q0FBNkM7UUFDN0MsRUFBRSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDYixPQUFPLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNsQixVQUFVLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtLQUN0QixDQUFDO0lBRUYsT0FBTyxjQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQyxDQUFDO0FBRUgsNkRBQTZEO0FBQzdELGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUIsWUFBWSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxjQUFJ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TUFBTSxFQUFFLEVBQUU7UUFDVixLQUFLLEVBQUUsRUFBRTtRQUNULE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFLGlCQUFTLENBQUMsY0FBYyxFQUFFO1FBQ2hDLEdBQUcsU0FBUztLQUNiLENBQUM7SUFFRixtQ0FBbUM7SUFDbkMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLE1BQU0sR0FBRyxHQUFRLEVBQUUsQ0FBQztRQUNwQixHQUFHLENBQUMsTUFBTSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsR0FBRyxDQUFDLElBQUksR0FBRyxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQyxHQUFHLENBQUMsTUFBTSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVELHdEQUF3RDtJQUN4RCxPQUFPLEVBQUUsQ0FBQyxFQUFVLEVBQUUsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztDQUN6RSxDQUFDO0FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxkZXZcXGNvbnRhYmlsXFxjb250YWJpbC1zaXRlXFxiYWNrZW5kXFx0ZXN0c1xcc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb25maWd1cmHDp8OjbyBnbG9iYWwgcGFyYSB0ZXN0ZXMgdW5pdMOhcmlvc1xuICogQ29udGFiaWxpZGFkZSBJZ3JlamluaGEgQmFja2VuZFxuICovXG5cbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8gQ29uZmlndXJhciB0aW1lem9uZSBwYXJhIHRlc3RlcyBjb25zaXN0ZW50ZXNcbnByb2Nlc3MuZW52LlRaID0gJ1VUQyc7XG5cbi8vIENvbmZpZ3VyYXIgdmFyacOhdmVpcyBkZSBhbWJpZW50ZSBwYXJhIHRlc3Rlc1xucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldCc7XG5wcm9jZXNzLmVudi5KV1RfRVhQSVJFU19JTiA9ICcxaCc7XG5wcm9jZXNzLmVudi5KV1RfUkVGUkVTSF9TRUNSRVQgPSAndGVzdC1yZWZyZXNoLXNlY3JldCc7XG5wcm9jZXNzLmVudi5KV1RfUkVGUkVTSF9FWFBJUkVTX0lOID0gJzdkJztcbnByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCA9ICdmaWxlOi4vdGVzdC5kYic7XG5wcm9jZXNzLmVudi5SRURJU19VUkwgPSAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OS8xJztcbnByb2Nlc3MuZW52LkxPR19MRVZFTCA9ICdlcnJvcic7XG5wcm9jZXNzLmVudi5VUExPQURfUEFUSCA9ICcuL3Rlc3QtdXBsb2Fkcyc7XG5cbi8vIE1vY2sgZGUgY29uc29sZSBwYXJhIHRlc3RlcyBtYWlzIGxpbXBvc1xuZ2xvYmFsLmNvbnNvbGUgPSB7XG4gIC4uLmNvbnNvbGUsXG4gIC8vIE1hbnRlciBhcGVuYXMgZXJyb3MgaW1wb3J0YW50ZXNcbiAgbG9nOiBqZXN0LmZuKCksXG4gIGRlYnVnOiBqZXN0LmZuKCksXG4gIGluZm86IGplc3QuZm4oKSxcbiAgd2FybjogamVzdC5mbigpLFxuICBlcnJvcjogY29uc29sZS5lcnJvciwgLy8gTWFudGVyIGVycm9zIHZpc8OtdmVpc1xufTtcblxuLy8gQ29uZmlndXJhw6fDtWVzIGdsb2JhaXMgZGUgdGltZW91dFxuamVzdC5zZXRUaW1lb3V0KDMwMDAwKTtcblxuLy8gTGltcGFyIHRvZG9zIG9zIG1vY2tzIGFww7NzIGNhZGEgdGVzdGVcbmFmdGVyRWFjaCgoKSA9PiB7XG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xufSk7XG5cbi8vIENvbmZpZ3VyYXIgbWF0Y2hlcnMgY3VzdG9taXphZG9zIChzZSBuZWNlc3PDoXJpbylcbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlVmFsaWREYXRlKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZWNlaXZlZC5nZXRUaW1lKCkpO1xuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgZGF0ZWAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgYSB2YWxpZCBkYXRlYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbiAgXG4gIHRvQmVWYWxpZFVVSUQocmVjZWl2ZWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHV1aWRSZWdleCA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kL2k7XG4gICAgY29uc3QgcGFzcyA9IHR5cGVvZiByZWNlaXZlZCA9PT0gJ3N0cmluZycgJiYgdXVpZFJlZ2V4LnRlc3QocmVjZWl2ZWQpO1xuICAgIFxuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGEgdmFsaWQgVVVJRGAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgYSB2YWxpZCBVVUlEYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbn0pO1xuXG4vLyBEZWNsYXJhciB0aXBvcyBwYXJhIG9zIG1hdGNoZXJzIGN1c3RvbWl6YWRvc1xuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgamVzdCB7XG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcbiAgICAgIHRvQmVWYWxpZERhdGUoKTogUjtcbiAgICAgIHRvQmVWYWxpZFVVSUQoKTogUjtcbiAgICB9XG4gIH1cbn1cblxuLy8gQ29uZmlndXJhciBtb2NrcyBnbG9iYWlzIHBhcmEgbcOzZHVsb3MgZXh0ZXJub3Ncbi8vIGplc3QubW9jaygnbm9kZW1haWxlcicsICgpID0+ICh7XG4vLyAgIGNyZWF0ZVRyYW5zcG9ydDogamVzdC5mbigoKSA9PiAoe1xuLy8gICAgIHNlbmRNYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoXCJUZXN0ZVwiICksXG4vLyAgICAgdmVyaWZ5OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4vLyAgIH0pKSxcbi8vIH0pKTtcblxuamVzdC5tb2NrKCdpb3JlZGlzJywgKCkgPT4ge1xuICBjb25zdCBtb2NrUmVkaXMgPSB7XG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgc2V0OiBqZXN0LmZuKCksXG4gICAgZGVsOiBqZXN0LmZuKCksXG4gICAgZXhpc3RzOiBqZXN0LmZuKCksXG4gICAgZXhwaXJlOiBqZXN0LmZuKCksXG4gICAgZmx1c2hhbGw6IGplc3QuZm4oKSxcbiAgICBxdWl0OiBqZXN0LmZuKCksXG4gICAgLy8gcGluZzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdQT05HJyksXG4gICAgb246IGplc3QuZm4oKSxcbiAgICBjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgZGlzY29ubmVjdDogamVzdC5mbigpLFxuICB9O1xuICBcbiAgcmV0dXJuIGplc3QuZm4oKCkgPT4gbW9ja1JlZGlzKTtcbn0pO1xuXG4vLyBNb2NrIGRvIHdpbnN0b24gcGFyYSBldml0YXIgcHJvYmxlbWFzIGRlIGxvZ2dpbmcgZW0gdGVzdGVzXG5qZXN0Lm1vY2soJ3dpbnN0b24nLCAoKSA9PiAoe1xuICBjcmVhdGVMb2dnZXI6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICB3YXJuOiBqZXN0LmZuKCksXG4gICAgZGVidWc6IGplc3QuZm4oKSxcbiAgfSkpLFxuICBmb3JtYXQ6IHtcbiAgICBjb21iaW5lOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gICAgdGltZXN0YW1wOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gICAgZXJyb3JzOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gICAganNvbjogamVzdC5mbigoKSA9PiBqZXN0LmZuKCkpLFxuICAgIGNvbG9yaXplOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gICAgc2ltcGxlOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gICAgcHJpbnRmOiBqZXN0LmZuKCgpID0+IGplc3QuZm4oKSksXG4gIH0sXG4gIHRyYW5zcG9ydHM6IHtcbiAgICBDb25zb2xlOiBqZXN0LmZuKCksXG4gICAgRmlsZTogamVzdC5mbigpLFxuICB9LFxufSkpO1xuXG4vLyBNb2NrIGRvIGxvZ2dlciBtaWRkbGV3YXJlXG5qZXN0Lm1vY2soJy4uL3NyYy9taWRkbGV3YXJlcy9sb2dnZXInLCAoKSA9PiAoe1xuICBsb2dnZXI6IHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICB3YXJuOiBqZXN0LmZuKCksXG4gICAgZGVidWc6IGplc3QuZm4oKSxcbiAgfSxcbiAgbG9nU3RyZWFtOiB7XG4gICAgd3JpdGU6IGplc3QuZm4oKSxcbiAgfSxcbiAgbG9nUGVyZm9ybWFuY2U6IGplc3QuZm4oKSxcbiAgbG9nRGF0YWJhc2VRdWVyeTogamVzdC5mbigpLFxuICBsb2dBdXRoOiBqZXN0LmZuKCksXG4gIGxvZ0ZpbGVVcGxvYWQ6IGplc3QuZm4oKSxcbiAgbG9nRW1haWw6IGplc3QuZm4oKSxcbiAgbG9nQ2FjaGU6IGplc3QuZm4oKSxcbn0pKTtcblxuLy8gTW9jayBkb3MgbWlkZGxld2FyZXMgZGUgc2VndXJhbsOnYVxuamVzdC5tb2NrKCcuLi9zcmMvbWlkZGxld2FyZXMvc2VjdXJpdHknLCAoKSA9PiAoe1xuICBjb3JzTWlkZGxld2FyZTogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIGhlbG1ldE1pZGRsZXdhcmU6IGplc3QuZm4oKHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSA9PiBuZXh0KCkpLFxuICBnZW5lcmFsUmF0ZUxpbWl0OiBqZXN0LmZuKChyZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkgPT4gbmV4dCgpKSxcbiAgYXV0aFJhdGVMaW1pdDogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIGFwaVJhdGVMaW1pdDogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIHVwbG9hZFJhdGVMaW1pdDogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIGNvbXByZXNzaW9uTWlkZGxld2FyZTogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIGN1c3RvbVNlY3VyaXR5SGVhZGVyczogamVzdC5mbigocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSksXG4gIHNlY3VyaXR5TG9nZ2VyOiBqZXN0LmZuKChyZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkgPT4gbmV4dCgpKSxcbn0pKTtcblxuLy8gTW9jayBkbyBleHByZXNzLXJhdGUtbGltaXRcbmplc3QubW9jaygnZXhwcmVzcy1yYXRlLWxpbWl0JywgKCkgPT4ge1xuICByZXR1cm4gamVzdC5mbigoKSA9PiAocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IG5leHQoKSk7XG59KTtcblxuLy8gTW9jayBkbyBtdWx0ZXIgcGFyYSB1cGxvYWQgZGUgYXJxdWl2b3Ncbmplc3QubW9jaygnbXVsdGVyJywgKCkgPT4ge1xuICBjb25zdCBtdWx0ZXIgPSAoKSA9PiAoe1xuICAgIHNpbmdsZTogKCkgPT4gKHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSA9PiB7XG4gICAgICByZXEuZmlsZSA9IHtcbiAgICAgICAgZmllbGRuYW1lOiAnZmlsZScsXG4gICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QuanBnJyxcbiAgICAgICAgZW5jb2Rpbmc6ICc3Yml0JyxcbiAgICAgICAgbWltZXR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgICAgc2l6ZTogMTAyNCxcbiAgICAgICAgZmlsZW5hbWU6ICd0ZXN0LTEyMy5qcGcnLFxuICAgICAgICBwYXRoOiAnL3RtcC90ZXN0LTEyMy5qcGcnLFxuICAgICAgfTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGFycmF5OiAoKSA9PiAocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IHtcbiAgICAgIHJlcS5maWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGZpZWxkbmFtZTogJ2ZpbGVzJyxcbiAgICAgICAgICBvcmlnaW5hbG5hbWU6ICd0ZXN0MS5qcGcnLFxuICAgICAgICAgIGVuY29kaW5nOiAnN2JpdCcsXG4gICAgICAgICAgbWltZXR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgICAgICBzaXplOiAxMDI0LFxuICAgICAgICAgIGZpbGVuYW1lOiAndGVzdDEtMTIzLmpwZycsXG4gICAgICAgICAgcGF0aDogJy90bXAvdGVzdDEtMTIzLmpwZycsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gIH0pO1xuICBcbiAgbXVsdGVyLm1lbW9yeVN0b3JhZ2UgPSBqZXN0LmZuKCk7XG4gIG11bHRlci5kaXNrU3RvcmFnZSA9IGplc3QuZm4oKTtcbiAgXG4gIHJldHVybiBtdWx0ZXI7XG59KTtcblxuLy8gVXRpbGl0w6FyaW9zIHBhcmEgdGVzdGVzXG5leHBvcnQgY29uc3QgdGVzdFV0aWxzID0ge1xuICAvLyBDcmlhciB1bSB1c3XDoXJpbyBkZSB0ZXN0ZVxuICBjcmVhdGVUZXN0VXNlcjogKCkgPT4gKHtcbiAgICBpZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgICByb2xlOiAnVVNFUicsXG4gICAgaXNBY3RpdmU6IHRydWUsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgfSksXG4gIFxuICAvLyBDcmlhciB1bSB0b2tlbiBKV1QgZGUgdGVzdGVcbiAgY3JlYXRlVGVzdFRva2VuOiAoKSA9PiAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LnRlc3QudG9rZW4nLFxuICBcbiAgLy8gQ3JpYXIgZGFkb3MgZGUgcmVxdWlzacOnw6NvIGRlIHRlc3RlXG4gIGNyZWF0ZVRlc3RSZXF1ZXN0OiAob3ZlcnJpZGVzID0ge30pID0+ICh7XG4gICAgYm9keToge30sXG4gICAgcGFyYW1zOiB7fSxcbiAgICBxdWVyeToge30sXG4gICAgaGVhZGVyczoge30sXG4gICAgdXNlcjogdGVzdFV0aWxzLmNyZWF0ZVRlc3RVc2VyKCksXG4gICAgLi4ub3ZlcnJpZGVzLFxuICB9KSxcbiAgXG4gIC8vIENyaWFyIGRhZG9zIGRlIHJlc3Bvc3RhIGRlIHRlc3RlXG4gIGNyZWF0ZVRlc3RSZXNwb25zZTogKCkgPT4ge1xuICAgIGNvbnN0IHJlczogYW55ID0ge307XG4gICAgcmVzLnN0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuanNvbiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuc2VuZCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuY29va2llID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShyZXMpO1xuICAgIHJlcy5jbGVhckNvb2tpZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXR1cm4gcmVzO1xuICB9LFxuICBcbiAgLy8gQWd1YXJkYXIgdW0gdGVtcG8gZXNwZWPDrWZpY28gKHBhcmEgdGVzdGVzIGNvbSB0aW1lcnMpXG4gIHdhaXRGb3I6IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKSxcbn07XG5cbmNvbnNvbGUubG9nKCfwn6eqIENvbmZpZ3VyYcOnw6NvIGRlIHRlc3RlcyBjYXJyZWdhZGEnKTsiXSwidmVyc2lvbiI6M30=