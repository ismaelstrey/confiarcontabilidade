ad1283cb7ca3f8c5363529a61eca7593
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock do Redis
jest.mock('ioredis');
// Mock do logger
jest.mock('../../utils/logger', () => ({
    info: jest.fn(),
    warn: jest.fn(),
    error: jest.fn(),
    debug: jest.fn(),
}));
// Mock do config
jest.mock('../../config/config', () => ({
    config: {
        cache: {
            redis: {
                host: 'localhost',
                port: 6379,
                password: '',
                db: 0,
            },
            ttl: 3600, // TTL padrão em segundos
        },
    },
}));
const ioredis_1 = __importDefault(require("ioredis"));
const logger_1 = __importDefault(require("../../utils/logger"));
const MockedRedis = ioredis_1.default;
// Importar após os mocks
const cacheService_1 = require("../cacheService");
describe('CacheService', () => {
    let mockRedisInstance;
    let cacheService;
    beforeEach(() => {
        jest.clearAllMocks();
        // Criar mock da instância do Redis
        mockRedisInstance = {
            connect: jest.fn(),
            disconnect: jest.fn(),
            setex: jest.fn(),
            get: jest.fn(),
            del: jest.fn(),
            keys: jest.fn(),
            exists: jest.fn(),
            expire: jest.fn(),
            ttl: jest.fn(),
            flushdb: jest.fn(),
            info: jest.fn(),
            on: jest.fn(),
            status: 'ready',
        };
        MockedRedis.mockImplementation(() => mockRedisInstance);
        // Criar nova instância para cada teste
        cacheService = new cacheService_1.CacheService();
        // Configurar o estado de conexão como true por padrão
        cacheService.isConnected = true;
    });
    describe('connect', () => {
        it('should connect to Redis successfully', async () => {
            mockRedisInstance.connect.mockResolvedValue(undefined);
            await cacheService.connect();
            expect(mockRedisInstance.connect).toHaveBeenCalled();
        });
        it('should handle connection errors', async () => {
            const error = new Error('Connection failed');
            mockRedisInstance.connect.mockRejectedValue(error);
            await expect(cacheService.connect()).rejects.toThrow('Connection failed');
            expect(logger_1.default.error).toHaveBeenCalledWith('Failed to connect to Redis:', error);
        });
    });
    describe('disconnect', () => {
        it('should disconnect from Redis successfully', async () => {
            mockRedisInstance.disconnect.mockResolvedValue('OK');
            await cacheService.disconnect();
            expect(mockRedisInstance.disconnect).toHaveBeenCalled();
        });
        it('should handle disconnection errors', async () => {
            const error = new Error('Disconnection failed');
            mockRedisInstance.disconnect.mockRejectedValue(error);
            await cacheService.disconnect();
            expect(logger_1.default.error).toHaveBeenCalledWith('Failed to disconnect from Redis:', error);
        });
    });
    describe('isRedisConnected', () => {
        it('should return true when Redis is connected', () => {
            // Mock do método privado isConnected
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
            const result = cacheService.isRedisConnected();
            expect(result).toBe(true);
        });
        it('should return false when Redis is not connected', () => {
            cacheService.isConnected = false;
            mockRedisInstance.status = 'disconnected';
            const result = cacheService.isRedisConnected();
            expect(result).toBe(false);
        });
    });
    describe('set', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should set a value in cache with default TTL', async () => {
            const key = 'test:key';
            const value = { data: 'test' };
            mockRedisInstance.setex.mockResolvedValue('OK');
            await cacheService.set(key, value);
            expect(mockRedisInstance.setex).toHaveBeenCalledWith(key, 3600, // TTL padrão da configuração
            JSON.stringify(value));
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache set: ${key} (TTL: 3600s)`);
        });
        it('should set a value in cache with custom TTL', async () => {
            const key = 'test:key';
            const value = { data: 'test' };
            const ttl = 1800;
            mockRedisInstance.setex.mockResolvedValue('OK');
            await cacheService.set(key, value, ttl);
            expect(mockRedisInstance.setex).toHaveBeenCalledWith(key, ttl, JSON.stringify(value));
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache set: ${key} (TTL: ${ttl}s)`);
        });
        it('should skip cache set when Redis is not connected', async () => {
            cacheService.isConnected = false;
            const key = 'test:key';
            const value = { data: 'test' };
            await cacheService.set(key, value);
            expect(mockRedisInstance.setex).not.toHaveBeenCalled();
            expect(logger_1.default.warn).toHaveBeenCalledWith('Redis not connected, skipping cache set');
        });
        it('should handle set errors gracefully', async () => {
            const key = 'test:key';
            const value = { data: 'test' };
            const error = new Error('Set failed');
            mockRedisInstance.setex.mockRejectedValue(error);
            await cacheService.set(key, value);
            expect(logger_1.default.error).toHaveBeenCalledWith(`Failed to set cache for key ${key}:`, error);
        });
    });
    describe('get', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should get a value from cache', async () => {
            const key = 'test:key';
            const value = { data: 'test' };
            mockRedisInstance.get.mockResolvedValue(JSON.stringify(value));
            const result = await cacheService.get(key);
            expect(mockRedisInstance.get).toHaveBeenCalledWith(key);
            expect(result).toEqual(value);
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache hit: ${key}`);
        });
        it('should return null when key does not exist', async () => {
            const key = 'test:key';
            mockRedisInstance.get.mockResolvedValue(null);
            const result = await cacheService.get(key);
            expect(result).toBeNull();
        });
        it('should return null when Redis is not connected', async () => {
            cacheService.isConnected = false;
            const key = 'test:key';
            const result = await cacheService.get(key);
            expect(result).toBeNull();
            expect(mockRedisInstance.get).not.toHaveBeenCalled();
            expect(logger_1.default.warn).toHaveBeenCalledWith('Redis not connected, skipping cache get');
        });
        it('should handle get errors gracefully', async () => {
            const key = 'test:key';
            const error = new Error('Get failed');
            mockRedisInstance.get.mockRejectedValue(error);
            const result = await cacheService.get(key);
            expect(result).toBeNull();
            expect(logger_1.default.error).toHaveBeenCalledWith(`Failed to get cache for key ${key}:`, error);
        });
    });
    describe('del', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should delete a key from cache', async () => {
            const key = 'test:key';
            mockRedisInstance.del.mockResolvedValue(1);
            await cacheService.del(key);
            expect(mockRedisInstance.del).toHaveBeenCalledWith(key);
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache deleted: ${key}`);
        });
        it('should skip delete when Redis is not connected', async () => {
            cacheService.isConnected = false;
            const key = 'test:key';
            await cacheService.del(key);
            expect(mockRedisInstance.del).not.toHaveBeenCalled();
            expect(logger_1.default.warn).toHaveBeenCalledWith('Redis not connected, skipping cache delete');
        });
    });
    describe('delMany', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should delete multiple keys from cache', async () => {
            const keys = ['test:key1', 'test:key2'];
            mockRedisInstance.del.mockResolvedValue(2);
            await cacheService.delMany(keys);
            expect(mockRedisInstance.del).toHaveBeenCalledWith(...keys);
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache deleted: ${keys.join(', ')}`);
        });
        it('should skip delete when keys array is empty', async () => {
            await cacheService.delMany([]);
            expect(mockRedisInstance.del).not.toHaveBeenCalled();
        });
    });
    describe('delPattern', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should delete keys matching pattern', async () => {
            const pattern = 'test:*';
            const keys = ['test:key1', 'test:key2'];
            mockRedisInstance.keys.mockResolvedValue(keys);
            mockRedisInstance.del.mockResolvedValue(2);
            await cacheService.delPattern(pattern);
            expect(mockRedisInstance.keys).toHaveBeenCalledWith(pattern);
            expect(mockRedisInstance.del).toHaveBeenCalledWith(...keys);
            expect(logger_1.default.debug).toHaveBeenCalledWith(`Cache pattern deleted: ${pattern} (${keys.length} keys)`);
        });
        it('should not delete when no keys match pattern', async () => {
            const pattern = 'test:*';
            mockRedisInstance.keys.mockResolvedValue([]);
            await cacheService.delPattern(pattern);
            expect(mockRedisInstance.keys).toHaveBeenCalledWith(pattern);
            expect(mockRedisInstance.del).not.toHaveBeenCalled();
        });
    });
    describe('exists', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should return true when key exists', async () => {
            const key = 'test:key';
            mockRedisInstance.exists.mockResolvedValue(1);
            const result = await cacheService.exists(key);
            expect(result).toBe(true);
            expect(mockRedisInstance.exists).toHaveBeenCalledWith(key);
        });
        it('should return false when key does not exist', async () => {
            const key = 'test:key';
            mockRedisInstance.exists.mockResolvedValue(0);
            const result = await cacheService.exists(key);
            expect(result).toBe(false);
        });
        it('should return false when Redis is not connected', async () => {
            cacheService.isConnected = false;
            const key = 'test:key';
            const result = await cacheService.exists(key);
            expect(result).toBe(false);
            expect(mockRedisInstance.exists).not.toHaveBeenCalled();
        });
    });
    describe('flush', () => {
        beforeEach(() => {
            cacheService.isConnected = true;
            mockRedisInstance.status = 'ready';
        });
        it('should flush all cache', async () => {
            mockRedisInstance.flushdb.mockResolvedValue('OK');
            await cacheService.flush();
            expect(mockRedisInstance.flushdb).toHaveBeenCalled();
            expect(logger_1.default.info).toHaveBeenCalledWith('Cache flushed');
        });
        it('should skip flush when Redis is not connected', async () => {
            cacheService.isConnected = false;
            await cacheService.flush();
            expect(mockRedisInstance.flushdb).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXGRldlxcY29udGFiaWxcXGNvbnRhYmlsLXNpdGVcXGJhY2tlbmRcXHNyY1xcc2VydmljZXNcXF9fdGVzdHNfX1xcY2FjaGVTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFHQSxnQkFBZ0I7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUdyQixpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNqQixDQUFDLENBQUMsQ0FBQztBQUVKLGlCQUFpQjtBQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdEMsTUFBTSxFQUFFO1FBQ04sS0FBSyxFQUFFO1lBQ0wsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRSxXQUFXO2dCQUNqQixJQUFJLEVBQUUsSUFBSTtnQkFDVixRQUFRLEVBQUUsRUFBRTtnQkFDWixFQUFFLEVBQUUsQ0FBQzthQUNOO1lBQ0QsR0FBRyxFQUFFLElBQUksRUFBRSx5QkFBeUI7U0FDckM7S0FDRjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBNUJKLHNEQUE0QjtBQUM1QixnRUFBd0M7QUFJeEMsTUFBTSxXQUFXLEdBQUcsaUJBQXVDLENBQUM7QUF5QjVELHlCQUF5QjtBQUN6QixrREFBK0M7QUFFL0MsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxpQkFBc0IsQ0FBQztJQUMzQixJQUFJLFlBQWlCLENBQUM7SUFFdEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVy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QUVILEVBQUUsQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0QyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEQsTUFBTSxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFM0IsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDckQsTUFBTSxDQUFDLGdCQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsWUFBb0IsQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1lBRTFDLE1BQU0sWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRTNCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUMzRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXGRldlxcY29udGFiaWxcXGNvbnRhYmlsLXNpdGVcXGJhY2tlbmRcXHNyY1xcc2VydmljZXNcXF9fdGVzdHNfX1xcY2FjaGVTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlZGlzIGZyb20gJ2lvcmVkaXMnO1xyXG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4uLy4uL3V0aWxzL2xvZ2dlcic7XHJcblxyXG4vLyBNb2NrIGRvIFJlZGlzXHJcbmplc3QubW9jaygnaW9yZWRpcycpO1xyXG5jb25zdCBNb2NrZWRSZWRpcyA9IFJlZGlzIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIFJlZGlzPjtcclxuXHJcbi8vIE1vY2sgZG8gbG9nZ2VyXHJcbmplc3QubW9jaygnLi4vLi4vdXRpbHMvbG9nZ2VyJywgKCkgPT4gKHtcclxuICBpbmZvOiBqZXN0LmZuKCksXHJcbiAgd2FybjogamVzdC5mbigpLFxyXG4gIGVycm9yOiBqZXN0LmZuKCksXHJcbiAgZGVidWc6IGplc3QuZm4oKSxcclxufSkpO1xyXG5cclxuLy8gTW9jayBkbyBjb25maWdcclxuamVzdC5tb2NrKCcuLi8uLi9jb25maWcvY29uZmlnJywgKCkgPT4gKHtcclxuICBjb25maWc6IHtcclxuICAgIGNhY2hlOiB7XHJcbiAgICAgIHJlZGlzOiB7XHJcbiAgICAgICAgaG9zdDogJ2xvY2FsaG9zdCcsXHJcbiAgICAgICAgcG9ydDogNjM3OSxcclxuICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgZGI6IDAsXHJcbiAgICAgIH0sXHJcbiAgICAgIHR0bDogMzYwMCwgLy8gVFRMIHBhZHLDo28gZW0gc2VndW5kb3NcclxuICAgIH0sXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gSW1wb3J0YXIgYXDDs3Mgb3MgbW9ja3NcclxuaW1wb3J0IHsgQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnLi4vY2FjaGVTZXJ2aWNlJztcclxuXHJcbmRlc2NyaWJlKCdDYWNoZVNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgbGV0IG1vY2tSZWRpc0luc3RhbmNlOiBhbnk7XHJcbiAgbGV0IGNhY2hlU2VydmljZTogYW55O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgXHJcbiAgICAvLyBDcmlhciBtb2NrIGRhIGluc3TDom5jaWEgZG8gUmVkaXNcclxuICAgIG1vY2tSZWRpc0luc3RhbmNlID0ge1xyXG4gICAgICBjb25uZWN0OiBqZXN0LmZuKCksXHJcbiAgICAgIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcclxuICAgICAgc2V0ZXg6IGplc3QuZm4oKSxcclxuICAgICAgZ2V0OiBqZXN0LmZuKCksXHJcbiAgICAgIGRlbDogamVzdC5mbigpLFxyXG4gICAgICBrZXlzOiBqZXN0LmZuKCksXHJcbiAgICAgIGV4aXN0czogamVzdC5mbigpLFxyXG4gICAgICBleHBpcmU6IGplc3QuZm4oKSxcclxuICAgICAgdHRsOiBqZXN0LmZuKCksXHJcbiAgICAgIGZsdXNoZGI6IGplc3QuZm4oKSxcclxuICAgICAgaW5mbzogamVzdC5mbigpLFxyXG4gICAgICBvbjogamVzdC5mbigpLFxyXG4gICAgICBzdGF0dXM6ICdyZWFkeScsXHJcbiAgICB9O1xyXG5cclxuICAgIE1vY2tlZFJlZGlzLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrUmVkaXNJbnN0YW5jZSk7XHJcbiAgICBcclxuICAgIC8vIENyaWFyIG5vdmEgaW5zdMOibmNpYSBwYXJhIGNhZGEgdGVzdGVcclxuICAgIGNhY2hlU2VydmljZSA9IG5ldyBDYWNoZVNlcnZpY2UoKTtcclxuICAgIC8vIENvbmZpZ3VyYXIgbyBlc3RhZG8gZGUgY29uZXjDo28gY29tbyB0cnVlIHBvciBwYWRyw6NvXHJcbiAgICAoY2FjaGVTZXJ2aWNlIGFzIGFueSkuaXNDb25uZWN0ZWQgPSB0cnVlO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29ubmVjdCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY29ubmVjdCB0byBSZWRpcyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLmNvbm5lY3QubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuXHJcbiAgICAgIGF3YWl0IGNhY2hlU2VydmljZS5jb25uZWN0KCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29ubmVjdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDb25uZWN0aW9uIGZhaWxlZCcpO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5jb25uZWN0Lm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjYWNoZVNlcnZpY2UuY29ubmVjdCgpKS5yZWplY3RzLnRvVGhyb3coJ0Nvbm5lY3Rpb24gZmFpbGVkJyk7XHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdGYWlsZWQgdG8gY29ubmVjdCB0byBSZWRpczonLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Rpc2Nvbm5lY3QnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGRpc2Nvbm5lY3QgZnJvbSBSZWRpcyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLmRpc2Nvbm5lY3QubW9ja1Jlc29sdmVkVmFsdWUoJ09LJyBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgY2FjaGVTZXJ2aWNlLmRpc2Nvbm5lY3QoKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVkaXNJbnN0YW5jZS5kaXNjb25uZWN0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaXNjb25uZWN0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0Rpc2Nvbm5lY3Rpb24gZmFpbGVkJyk7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLmRpc2Nvbm5lY3QubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xyXG5cclxuICAgICAgYXdhaXQgY2FjaGVTZXJ2aWNlLmRpc2Nvbm5lY3QoKTtcclxuXHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdGYWlsZWQgdG8gZGlzY29ubmVjdCBmcm9tIFJlZGlzOicsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnaXNSZWRpc0Nvbm5lY3RlZCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiBSZWRpcyBpcyBjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIC8vIE1vY2sgZG8gbcOpdG9kbyBwcml2YWRvIGlzQ29ubmVjdGVkXHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdyZWFkeSc7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBjYWNoZVNlcnZpY2UuaXNSZWRpc0Nvbm5lY3RlZCgpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gUmVkaXMgaXMgbm90IGNvbm5lY3RlZCcsICgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdkaXNjb25uZWN0ZWQnIGFzIGFueTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhY2hlU2VydmljZS5pc1JlZGlzQ29ubmVjdGVkKCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnc2V0JywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdyZWFkeSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHNldCBhIHZhbHVlIGluIGNhY2hlIHdpdGggZGVmYXVsdCBUVEwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdCcgfTtcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2Uuc2V0ZXgubW9ja1Jlc29sdmVkVmFsdWUoJ09LJyk7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2Uuc2V0KGtleSwgdmFsdWUpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLnNldGV4KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBrZXksXHJcbiAgICAgICAgMzYwMCwgLy8gVFRMIHBhZHLDo28gZGEgY29uZmlndXJhw6fDo29cclxuICAgICAgICBKU09OLnN0cmluZ2lmeSh2YWx1ZSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KGxvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoYENhY2hlIHNldDogJHtrZXl9IChUVEw6IDM2MDBzKWApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBzZXQgYSB2YWx1ZSBpbiBjYWNoZSB3aXRoIGN1c3RvbSBUVEwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdCcgfTtcclxuICAgICAgY29uc3QgdHRsID0gMTgwMDtcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2Uuc2V0ZXgubW9ja1Jlc29sdmVkVmFsdWUoJ09LJyk7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIHR0bCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2Uuc2V0ZXgpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGtleSxcclxuICAgICAgICB0dGwsXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUpXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGBDYWNoZSBzZXQ6ICR7a2V5fSAoVFRMOiAke3R0bH1zKWApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBza2lwIGNhY2hlIHNldCB3aGVuIFJlZGlzIGlzIG5vdCBjb25uZWN0ZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xyXG4gICAgICBjb25zdCBrZXkgPSAndGVzdDprZXknO1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QnIH07XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2Uuc2V0KGtleSwgdmFsdWUpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLnNldGV4KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdSZWRpcyBub3QgY29ubmVjdGVkLCBza2lwcGluZyBjYWNoZSBzZXQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNldCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Q6a2V5JztcclxuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0JyB9O1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignU2V0IGZhaWxlZCcpO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5zZXRleC5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2Uuc2V0KGtleSwgdmFsdWUpO1xyXG5cclxuICAgICAgZXhwZWN0KGxvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoYEZhaWxlZCB0byBzZXQgY2FjaGUgZm9yIGtleSAke2tleX06YCwgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXQnLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2Uuc3RhdHVzID0gJ3JlYWR5JztcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZ2V0IGEgdmFsdWUgZnJvbSBjYWNoZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Q6a2V5JztcclxuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0JyB9O1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhY2hlU2VydmljZS5nZXQoa2V5KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVkaXNJbnN0YW5jZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGtleSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLmRlYnVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgQ2FjaGUgaGl0OiAke2tleX1gKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBrZXkgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhY2hlU2VydmljZS5nZXQoa2V5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gUmVkaXMgaXMgbm90IGNvbm5lY3RlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWNoZVNlcnZpY2UuZ2V0KGtleSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuZ2V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdSZWRpcyBub3QgY29ubmVjdGVkLCBza2lwcGluZyBjYWNoZSBnZXQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGdldCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Q6a2V5JztcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0dldCBmYWlsZWQnKTtcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2UuZ2V0Lm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhY2hlU2VydmljZS5nZXQoa2V5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGBGYWlsZWQgdG8gZ2V0IGNhY2hlIGZvciBrZXkgJHtrZXl9OmAsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGVsJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdyZWFkeSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBhIGtleSBmcm9tIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBrZXkgPSAndGVzdDprZXknO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5kZWwubW9ja1Jlc29sdmVkVmFsdWUoMSk7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2UuZGVsKGtleSk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuZGVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChrZXkpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLmRlYnVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgQ2FjaGUgZGVsZXRlZDogJHtrZXl9YCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHNraXAgZGVsZXRlIHdoZW4gUmVkaXMgaXMgbm90IGNvbm5lY3RlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2UuZGVsKGtleSk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuZGVsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdSZWRpcyBub3QgY29ubmVjdGVkLCBza2lwcGluZyBjYWNoZSBkZWxldGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGVsTWFueScsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAoY2FjaGVTZXJ2aWNlIGFzIGFueSkuaXNDb25uZWN0ZWQgPSB0cnVlO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5zdGF0dXMgPSAncmVhZHknO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgbXVsdGlwbGUga2V5cyBmcm9tIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBrZXlzID0gWyd0ZXN0OmtleTEnLCAndGVzdDprZXkyJ107XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLmRlbC5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcclxuXHJcbiAgICAgIGF3YWl0IGNhY2hlU2VydmljZS5kZWxNYW55KGtleXMpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmRlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoLi4ua2V5cyk7XHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGBDYWNoZSBkZWxldGVkOiAke2tleXMuam9pbignLCAnKX1gKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2tpcCBkZWxldGUgd2hlbiBrZXlzIGFycmF5IGlzIGVtcHR5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2UuZGVsTWFueShbXSk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuZGVsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkZWxQYXR0ZXJuJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdyZWFkeSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBrZXlzIG1hdGNoaW5nIHBhdHRlcm4nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAndGVzdDoqJztcclxuICAgICAgY29uc3Qga2V5cyA9IFsndGVzdDprZXkxJywgJ3Rlc3Q6a2V5MiddO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5rZXlzLm1vY2tSZXNvbHZlZFZhbHVlKGtleXMpO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5kZWwubW9ja1Jlc29sdmVkVmFsdWUoMik7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2UuZGVsUGF0dGVybihwYXR0ZXJuKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVkaXNJbnN0YW5jZS5rZXlzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChwYXR0ZXJuKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmRlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoLi4ua2V5cyk7XHJcbiAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGBDYWNoZSBwYXR0ZXJuIGRlbGV0ZWQ6ICR7cGF0dGVybn0gKCR7a2V5cy5sZW5ndGh9IGtleXMpYCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCBkZWxldGUgd2hlbiBubyBrZXlzIG1hdGNoIHBhdHRlcm4nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAndGVzdDoqJztcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2Uua2V5cy5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XHJcblxyXG4gICAgICBhd2FpdCBjYWNoZVNlcnZpY2UuZGVsUGF0dGVybihwYXR0ZXJuKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVkaXNJbnN0YW5jZS5rZXlzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChwYXR0ZXJuKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmRlbCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZXhpc3RzJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIChjYWNoZVNlcnZpY2UgYXMgYW55KS5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgIG1vY2tSZWRpc0luc3RhbmNlLnN0YXR1cyA9ICdyZWFkeSc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIHdoZW4ga2V5IGV4aXN0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Q6a2V5JztcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2UuZXhpc3RzLm1vY2tSZXNvbHZlZFZhbHVlKDEpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FjaGVTZXJ2aWNlLmV4aXN0cyhrZXkpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmV4aXN0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoa2V5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4ga2V5IGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBrZXkgPSAndGVzdDprZXknO1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5leGlzdHMubW9ja1Jlc29sdmVkVmFsdWUoMCk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWNoZVNlcnZpY2UuZXhpc3RzKGtleSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gUmVkaXMgaXMgbm90IGNvbm5lY3RlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gZmFsc2U7XHJcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0OmtleSc7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWNoZVNlcnZpY2UuZXhpc3RzKGtleSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmV4aXN0cykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZmx1c2gnLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgKGNhY2hlU2VydmljZSBhcyBhbnkpLmlzQ29ubmVjdGVkID0gdHJ1ZTtcclxuICAgICAgbW9ja1JlZGlzSW5zdGFuY2Uuc3RhdHVzID0gJ3JlYWR5JztcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZmx1c2ggYWxsIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVkaXNJbnN0YW5jZS5mbHVzaGRiLm1vY2tSZXNvbHZlZFZhbHVlKCdPSycpO1xyXG5cclxuICAgICAgYXdhaXQgY2FjaGVTZXJ2aWNlLmZsdXNoKCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1JlZGlzSW5zdGFuY2UuZmx1c2hkYikudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdDYWNoZSBmbHVzaGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHNraXAgZmx1c2ggd2hlbiBSZWRpcyBpcyBub3QgY29ubmVjdGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAoY2FjaGVTZXJ2aWNlIGFzIGFueSkuaXNDb25uZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgIGF3YWl0IGNhY2hlU2VydmljZS5mbHVzaCgpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZWRpc0luc3RhbmNlLmZsdXNoZGIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9