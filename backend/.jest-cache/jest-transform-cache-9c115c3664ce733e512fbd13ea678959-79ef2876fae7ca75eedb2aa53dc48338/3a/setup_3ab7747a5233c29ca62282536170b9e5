fd435ed652839efe14ff1f3fbce32b28
"use strict";
/**
 * Configura칞칚o global para testes unit치rios
 * Contabilidade Igrejinha Backend
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.testUtils = void 0;
const globals_1 = require("@jest/globals");
// Configurar mocks globais para m칩dulos externos
// jest.mock('nodemailer', () => ({
//   createTransport: jest.fn(() => ({
//     sendMail: jest.fn().mockResolvedValue("Teste" ),
//     verify: jest.fn().mockResolvedValue(true),
//   })),
// }));
globals_1.jest.mock('ioredis', () => {
    const mockRedis = {
        get: globals_1.jest.fn(),
        set: globals_1.jest.fn(),
        del: globals_1.jest.fn(),
        exists: globals_1.jest.fn(),
        expire: globals_1.jest.fn(),
        flushall: globals_1.jest.fn(),
        quit: globals_1.jest.fn(),
        // ping: jest.fn().mockResolvedValue('PONG'),
        on: globals_1.jest.fn(),
        connect: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
    };
    return globals_1.jest.fn(() => mockRedis);
});
// Mock do Winston para logs
globals_1.jest.mock('winston', () => ({
    createLogger: globals_1.jest.fn(() => ({
        info: globals_1.jest.fn(),
        error: globals_1.jest.fn(),
        warn: globals_1.jest.fn(),
        debug: globals_1.jest.fn(),
    })),
    format: {
        combine: globals_1.jest.fn(),
        timestamp: globals_1.jest.fn(),
        errors: globals_1.jest.fn(),
        json: globals_1.jest.fn(),
        colorize: globals_1.jest.fn(),
        simple: globals_1.jest.fn(),
    },
    transports: {
        Console: globals_1.jest.fn(),
        File: globals_1.jest.fn(),
    },
}));
// Mock do multer para upload de arquivos
globals_1.jest.mock('multer', () => {
    const multer = () => ({
        single: () => (req, res, next) => {
            req.file = {
                fieldname: 'file',
                originalname: 'test.jpg',
                encoding: '7bit',
                mimetype: 'image/jpeg',
                size: 1024,
                filename: 'test-123.jpg',
                path: '/tmp/test-123.jpg',
            };
            next();
        },
        array: () => (req, res, next) => {
            req.files = [
                {
                    fieldname: 'files',
                    originalname: 'test1.jpg',
                    encoding: '7bit',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    filename: 'test1-123.jpg',
                    path: '/tmp/test1-123.jpg',
                },
            ];
            next();
        },
    });
    multer.memoryStorage = globals_1.jest.fn();
    multer.diskStorage = globals_1.jest.fn();
    return multer;
});
// Configurar timezone para testes consistentes
process.env.TZ = 'UTC';
// Configurar vari치veis de ambiente para testes
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret';
process.env.JWT_EXPIRES_IN = '1h';
process.env.JWT_REFRESH_SECRET = 'test-refresh-secret';
process.env.JWT_REFRESH_EXPIRES_IN = '7d';
process.env.DATABASE_URL = 'file:./test.db';
process.env.REDIS_URL = 'redis://localhost:6379/1';
process.env.LOG_LEVEL = 'error';
process.env.UPLOAD_PATH = './test-uploads';
// Mock de console para testes mais limpos
global.console = {
    ...console,
    // Manter apenas erros importantes
    log: globals_1.jest.fn(),
    debug: globals_1.jest.fn(),
    info: globals_1.jest.fn(),
    warn: globals_1.jest.fn(),
    error: console.error, // Manter erros vis칤veis
};
// Mock de setTimeout e setInterval para testes mais r치pidos
globals_1.jest.useFakeTimers();
// Configura칞칫es globais de timeout
globals_1.jest.setTimeout(30000);
// Limpar todos os mocks ap칩s cada teste
afterEach(() => {
    globals_1.jest.clearAllMocks();
    globals_1.jest.clearAllTimers();
});
// Restaurar timers reais ap칩s todos os testes
afterAll(() => {
    globals_1.jest.useRealTimers();
});
// Configurar matchers customizados (se necess치rio)
expect.extend({
    toBeValidDate(received) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid date`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid date`,
                pass: false,
            };
        }
    },
    toBeValidUUID(received) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        const pass = typeof received === 'string' && uuidRegex.test(received);
        if (pass) {
            return {
                message: () => `expected ${received} not to be a valid UUID`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be a valid UUID`,
                pass: false,
            };
        }
    },
});
// Utilit치rios para testes
exports.testUtils = {
    // Criar um usu치rio de teste
    createTestUser: () => ({
        id: '123e4567-e89b-12d3-a456-426614174000',
        email: 'test@example.com',
        name: 'Test User',
        role: 'USER',
        isActive: true,
        createdAt: new Date(),
        updatedAt: new Date(),
    }),
    // Criar um token JWT de teste
    createTestToken: () => 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.token',
    // Criar dados de requisi칞칚o de teste
    createTestRequest: (overrides = {}) => ({
        body: {},
        params: {},
        query: {},
        headers: {},
        user: exports.testUtils.createTestUser(),
        ...overrides,
    }),
    // Criar dados de resposta de teste
    createTestResponse: () => {
        const res = {};
        res.status = globals_1.jest.fn().mockReturnValue(res);
        res.json = globals_1.jest.fn().mockReturnValue(res);
        res.send = globals_1.jest.fn().mockReturnValue(res);
        res.cookie = globals_1.jest.fn().mockReturnValue(res);
        res.clearCookie = globals_1.jest.fn().mockReturnValue(res);
        return res;
    },
    // Aguardar um tempo espec칤fico (para testes com timers)
    waitFor: (ms) => new Promise(resolve => setTimeout(resolve, ms)),
};
console.log('游빍 Configura칞칚o de testes carregada');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXGRldlxcY29udGFiaWxcXGNvbnRhYmlsLXNpdGVcXGJhY2tlbmRcXHRlc3RzXFxzZXR1cC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFFSCwyQ0FBcUM7QUF5RnJDLGlEQUFpRDtBQUNqRCxtQ0FBbUM7QUFDbkMsc0NBQXNDO0FBQ3RDLHVEQUF1RDtBQUN2RCxpREFBaUQ7QUFDakQsU0FBUztBQUNULE9BQU87QUFFUCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDeEIsTUFBTSxTQUFTLEdBQUc7UUFDaEIsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsTUFBTSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsUUFBUSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbkIsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZiw2Q0FBNkM7UUFDN0MsRUFBRSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDYixPQUFPLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNsQixVQUFVLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtLQUN0QixDQUFDO0lBRUYsT0FBTyxjQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQyxDQUFDO0FBRUgsNEJBQTRCO0FBQzVCLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUIsWUFBWSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxjQUFJ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UUFDVCxPQUFPLEVBQUUsRUFBRTtRQUNYLElBQUksRUFBRSxpQkFBUyxDQUFDLGNBQWMsRUFBRTtRQUNoQyxHQUFHLFNBQVM7S0FDYixDQUFDO0lBRUYsbUNBQW1DO0lBQ25DLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUN2QixNQUFNLEdBQUcsR0FBUSxFQUFFLENBQUM7UUFDcEIsR0FBRyxDQUFDLE1BQU0sR0FBRyxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQyxHQUFHLENBQUMsSUFBSSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCx3REFBd0Q7SUFDeEQsT0FBTyxFQUFFLENBQUMsRUFBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7Q0FDekUsQ0FBQztBQUVGLE9BQU8sQ0FBQyxHQUFHLENBQUMscUNBQXFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcZGV2XFxjb250YWJpbFxcY29udGFiaWwtc2l0ZVxcYmFja2VuZFxcdGVzdHNcXHNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29uZmlndXJhw6fDo28gZ2xvYmFsIHBhcmEgdGVzdGVzIHVuaXTDoXJpb3NcbiAqIENvbnRhYmlsaWRhZGUgSWdyZWppbmhhIEJhY2tlbmRcbiAqL1xuXG5pbXBvcnQgeyBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbi8vIENvbmZpZ3VyYXIgdGltZXpvbmUgcGFyYSB0ZXN0ZXMgY29uc2lzdGVudGVzXG5wcm9jZXNzLmVudi5UWiA9ICdVVEMnO1xuXG4vLyBDb25maWd1cmFyIHZhcmnDoXZlaXMgZGUgYW1iaWVudGUgcGFyYSB0ZXN0ZXNcbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xucHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCA9ICd0ZXN0LWp3dC1zZWNyZXQnO1xucHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gPSAnMWgnO1xucHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfU0VDUkVUID0gJ3Rlc3QtcmVmcmVzaC1zZWNyZXQnO1xucHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiA9ICc3ZCc7XG5wcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPSAnZmlsZTouL3Rlc3QuZGInO1xucHJvY2Vzcy5lbnYuUkVESVNfVVJMID0gJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzkvMSc7XG5wcm9jZXNzLmVudi5MT0dfTEVWRUwgPSAnZXJyb3InO1xucHJvY2Vzcy5lbnYuVVBMT0FEX1BBVEggPSAnLi90ZXN0LXVwbG9hZHMnO1xuXG4vLyBNb2NrIGRlIGNvbnNvbGUgcGFyYSB0ZXN0ZXMgbWFpcyBsaW1wb3Ncbmdsb2JhbC5jb25zb2xlID0ge1xuICAuLi5jb25zb2xlLFxuICAvLyBNYW50ZXIgYXBlbmFzIGVycm9zIGltcG9ydGFudGVzXG4gIGxvZzogamVzdC5mbigpLFxuICBkZWJ1ZzogamVzdC5mbigpLFxuICBpbmZvOiBqZXN0LmZuKCksXG4gIHdhcm46IGplc3QuZm4oKSxcbiAgZXJyb3I6IGNvbnNvbGUuZXJyb3IsIC8vIE1hbnRlciBlcnJvcyB2aXPDrXZlaXNcbn07XG5cbi8vIE1vY2sgZGUgc2V0VGltZW91dCBlIHNldEludGVydmFsIHBhcmEgdGVzdGVzIG1haXMgcsOhcGlkb3Ncbmplc3QudXNlRmFrZVRpbWVycygpO1xuXG4vLyBDb25maWd1cmHDp8O1ZXMgZ2xvYmFpcyBkZSB0aW1lb3V0XG5qZXN0LnNldFRpbWVvdXQoMzAwMDApO1xuXG4vLyBMaW1wYXIgdG9kb3Mgb3MgbW9ja3MgYXDDs3MgY2FkYSB0ZXN0ZVxuYWZ0ZXJFYWNoKCgpID0+IHtcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbn0pO1xuXG4vLyBSZXN0YXVyYXIgdGltZXJzIHJlYWlzIGFww7NzIHRvZG9zIG9zIHRlc3Rlc1xuYWZ0ZXJBbGwoKCkgPT4ge1xuICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbn0pO1xuXG4vLyBDb25maWd1cmFyIG1hdGNoZXJzIGN1c3RvbWl6YWRvcyAoc2UgbmVjZXNzw6FyaW8pXG5leHBlY3QuZXh0ZW5kKHtcbiAgdG9CZVZhbGlkRGF0ZShyZWNlaXZlZDogYW55KSB7XG4gICAgY29uc3QgcGFzcyA9IHJlY2VpdmVkIGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4ocmVjZWl2ZWQuZ2V0VGltZSgpKTtcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSBhIHZhbGlkIGRhdGVgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgZGF0ZWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIFxuICB0b0JlVmFsaWRVVUlEKHJlY2VpdmVkOiBzdHJpbmcpIHtcbiAgICBjb25zdCB1dWlkUmVnZXggPSAvXlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9JC9pO1xuICAgIGNvbnN0IHBhc3MgPSB0eXBlb2YgcmVjZWl2ZWQgPT09ICdzdHJpbmcnICYmIHV1aWRSZWdleC50ZXN0KHJlY2VpdmVkKTtcbiAgICBcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSBhIHZhbGlkIFVVSURgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgVVVJRGAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG59KTtcblxuLy8gRGVjbGFyYXIgdGlwb3MgcGFyYSBvcyBtYXRjaGVycyBjdXN0b21pemFkb3NcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0JlVmFsaWREYXRlKCk6IFI7XG4gICAgICB0b0JlVmFsaWRVVUlEKCk6IFI7XG4gICAgfVxuICB9XG59XG5cbi8vIENvbmZpZ3VyYXIgbW9ja3MgZ2xvYmFpcyBwYXJhIG3Ds2R1bG9zIGV4dGVybm9zXG4vLyBqZXN0Lm1vY2soJ25vZGVtYWlsZXInLCAoKSA9PiAoe1xuLy8gICBjcmVhdGVUcmFuc3BvcnQ6IGplc3QuZm4oKCkgPT4gKHtcbi8vICAgICBzZW5kTWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFwiVGVzdGVcIiApLFxuLy8gICAgIHZlcmlmeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuLy8gICB9KSksXG4vLyB9KSk7XG5cbmplc3QubW9jaygnaW9yZWRpcycsICgpID0+IHtcbiAgY29uc3QgbW9ja1JlZGlzID0ge1xuICAgIGdldDogamVzdC5mbigpLFxuICAgIHNldDogamVzdC5mbigpLFxuICAgIGRlbDogamVzdC5mbigpLFxuICAgIGV4aXN0czogamVzdC5mbigpLFxuICAgIGV4cGlyZTogamVzdC5mbigpLFxuICAgIGZsdXNoYWxsOiBqZXN0LmZuKCksXG4gICAgcXVpdDogamVzdC5mbigpLFxuICAgIC8vIHBpbmc6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnUE9ORycpLFxuICAgIG9uOiBqZXN0LmZuKCksXG4gICAgY29ubmVjdDogamVzdC5mbigpLFxuICAgIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcbiAgfTtcbiAgXG4gIHJldHVybiBqZXN0LmZuKCgpID0+IG1vY2tSZWRpcyk7XG59KTtcblxuLy8gTW9jayBkbyBXaW5zdG9uIHBhcmEgbG9nc1xuamVzdC5tb2NrKCd3aW5zdG9uJywgKCkgPT4gKHtcbiAgY3JlYXRlTG9nZ2VyOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgaW5mbzogamVzdC5mbigpLFxuICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgd2FybjogamVzdC5mbigpLFxuICAgIGRlYnVnOiBqZXN0LmZuKCksXG4gIH0pKSxcbiAgZm9ybWF0OiB7XG4gICAgY29tYmluZTogamVzdC5mbigpLFxuICAgIHRpbWVzdGFtcDogamVzdC5mbigpLFxuICAgIGVycm9yczogamVzdC5mbigpLFxuICAgIGpzb246IGplc3QuZm4oKSxcbiAgICBjb2xvcml6ZTogamVzdC5mbigpLFxuICAgIHNpbXBsZTogamVzdC5mbigpLFxuICB9LFxuICB0cmFuc3BvcnRzOiB7XG4gICAgQ29uc29sZTogamVzdC5mbigpLFxuICAgIEZpbGU6IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gTW9jayBkbyBtdWx0ZXIgcGFyYSB1cGxvYWQgZGUgYXJxdWl2b3Ncbmplc3QubW9jaygnbXVsdGVyJywgKCkgPT4ge1xuICBjb25zdCBtdWx0ZXIgPSAoKSA9PiAoe1xuICAgIHNpbmdsZTogKCkgPT4gKHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSA9PiB7XG4gICAgICByZXEuZmlsZSA9IHtcbiAgICAgICAgZmllbGRuYW1lOiAnZmlsZScsXG4gICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QuanBnJyxcbiAgICAgICAgZW5jb2Rpbmc6ICc3Yml0JyxcbiAgICAgICAgbWltZXR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgICAgc2l6ZTogMTAyNCxcbiAgICAgICAgZmlsZW5hbWU6ICd0ZXN0LTEyMy5qcGcnLFxuICAgICAgICBwYXRoOiAnL3RtcC90ZXN0LTEyMy5qcGcnLFxuICAgICAgfTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGFycmF5OiAoKSA9PiAocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IHtcbiAgICAgIHJlcS5maWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGZpZWxkbmFtZTogJ2ZpbGVzJyxcbiAgICAgICAgICBvcmlnaW5hbG5hbWU6ICd0ZXN0MS5qcGcnLFxuICAgICAgICAgIGVuY29kaW5nOiAnN2JpdCcsXG4gICAgICAgICAgbWltZXR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgICAgICBzaXplOiAxMDI0LFxuICAgICAgICAgIGZpbGVuYW1lOiAndGVzdDEtMTIzLmpwZycsXG4gICAgICAgICAgcGF0aDogJy90bXAvdGVzdDEtMTIzLmpwZycsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gIH0pO1xuICBcbiAgbXVsdGVyLm1lbW9yeVN0b3JhZ2UgPSBqZXN0LmZuKCk7XG4gIG11bHRlci5kaXNrU3RvcmFnZSA9IGplc3QuZm4oKTtcbiAgXG4gIHJldHVybiBtdWx0ZXI7XG59KTtcblxuLy8gVXRpbGl0w6FyaW9zIHBhcmEgdGVzdGVzXG5leHBvcnQgY29uc3QgdGVzdFV0aWxzID0ge1xuICAvLyBDcmlhciB1bSB1c3XDoXJpbyBkZSB0ZXN0ZVxuICBjcmVhdGVUZXN0VXNlcjogKCkgPT4gKHtcbiAgICBpZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgICByb2xlOiAnVVNFUicsXG4gICAgaXNBY3RpdmU6IHRydWUsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgfSksXG4gIFxuICAvLyBDcmlhciB1bSB0b2tlbiBKV1QgZGUgdGVzdGVcbiAgY3JlYXRlVGVzdFRva2VuOiAoKSA9PiAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LnRlc3QudG9rZW4nLFxuICBcbiAgLy8gQ3JpYXIgZGFkb3MgZGUgcmVxdWlzacOnw6NvIGRlIHRlc3RlXG4gIGNyZWF0ZVRlc3RSZXF1ZXN0OiAob3ZlcnJpZGVzID0ge30pID0+ICh7XG4gICAgYm9keToge30sXG4gICAgcGFyYW1zOiB7fSxcbiAgICBxdWVyeToge30sXG4gICAgaGVhZGVyczoge30sXG4gICAgdXNlcjogdGVzdFV0aWxzLmNyZWF0ZVRlc3RVc2VyKCksXG4gICAgLi4ub3ZlcnJpZGVzLFxuICB9KSxcbiAgXG4gIC8vIENyaWFyIGRhZG9zIGRlIHJlc3Bvc3RhIGRlIHRlc3RlXG4gIGNyZWF0ZVRlc3RSZXNwb25zZTogKCkgPT4ge1xuICAgIGNvbnN0IHJlczogYW55ID0ge307XG4gICAgcmVzLnN0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuanNvbiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuc2VuZCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXMuY29va2llID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShyZXMpO1xuICAgIHJlcy5jbGVhckNvb2tpZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcbiAgICByZXR1cm4gcmVzO1xuICB9LFxuICBcbiAgLy8gQWd1YXJkYXIgdW0gdGVtcG8gZXNwZWPDrWZpY28gKHBhcmEgdGVzdGVzIGNvbSB0aW1lcnMpXG4gIHdhaXRGb3I6IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKSxcbn07XG5cbmNvbnNvbGUubG9nKCfwn6eqIENvbmZpZ3VyYcOnw6NvIGRlIHRlc3RlcyBjYXJyZWdhZGEnKTsiXSwidmVyc2lvbiI6M30=